---
import type { Lang } from '../../i18n/ui';
import { useTranslations, getLocalizedPath } from '../../i18n/utils';
import type { Book } from '../../i18n/books';
import AmazonButton from './AmazonButton.astro';
import MaterialsSection from './MaterialsSection.astro';

interface Props {
  book: Book;
  lang: Lang;
}

const { book, lang } = Astro.props;
const t = useTranslations(lang);
const base = import.meta.env.BASE_URL.replace(/\/$/, '');
const booksPath = getLocalizedPath(lang, lang === 'es' ? '/libros' : '/books');
---

<div class="max-w-4xl mx-auto px-4 py-8 md:py-16">
  <a href={booksPath} class="text-gold-400 hover:text-gold-300 transition-colors text-sm font-semibold">
    {t('books.backToBooks')}
  </a>

  <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-8 md:gap-12 items-start">
    <!-- Cover -->
    <div class={`aspect-[3/4] bg-gradient-to-b ${book.color} rounded-2xl overflow-hidden flex items-center justify-center p-8 shadow-xl`}>
      <img
        src={`${base}${book.coverPlaceholder}`}
        alt={book.title[lang]}
        class="w-full h-full object-contain drop-shadow-lg"
      />
    </div>

    <!-- Info -->
    <div>
      <span class="text-gold-500 text-sm font-bold uppercase tracking-wider">
        {t('series.mission')} {book.mission}
      </span>
      <h1 class="font-title text-3xl md:text-4xl font-bold text-white mt-2 leading-tight">
        {book.title[lang]}
      </h1>
      <p class="text-night-300 mt-2 text-lg">
        {book.theme[lang]}
      </p>

      <div class="mt-6">
        <AmazonButton isbn={book.isbn} lang={lang} />
      </div>

      <div class="mt-8">
        <h2 class="font-title text-xl font-bold text-gold-400 mb-3">
          {t('books.synopsis')}
        </h2>
        <p class="text-night-200 leading-relaxed">
          {book.synopsis[lang]}
        </p>
      </div>

      <div class="mt-6 p-4 bg-night-800/30 rounded-xl border border-night-700/20">
        <h3 class="text-sm font-bold text-night-300 uppercase tracking-wider mb-3">
          {t('books.details')}
        </h3>
        <dl class="space-y-2 text-sm">
          <div class="flex justify-between">
            <dt class="text-night-400">{t('books.age')}</dt>
            <dd class="text-night-200 font-semibold">{t('books.ageRange')}</dd>
          </div>
          {book.isbn && (
            <div class="flex justify-between">
              <dt class="text-night-400">{t('books.isbn')}</dt>
              <dd class="text-night-200 font-semibold">{book.isbn}</dd>
            </div>
          )}
        </dl>
      </div>
    </div>
  </div>

  <MaterialsSection lang={lang} />
</div>
